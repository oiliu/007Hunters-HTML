var hotCity = [
{
	n:'北京',
	d:['东城区','西城区','崇文区 ','宣武区','海淀区','朝阳区','丰台区','石景山区','通州区','顺义区',' 房山区','大兴区','昌平区','怀柔区','平谷区','门头沟区','密云县','延庆县']
},
{
	n:'上海',
	d:['黄浦区','徐汇区','长宁区','静安区','普陀区','闸北区','虹口区','杨浦区','闵行区','宝山区','嘉定区','浦东新区','金山区','松江区','青浦区','奉贤区	','崇明县']
},
{
	n:'广州',
	d:['越秀区','海珠区','荔湾区','天河区','白云区','黄埔区','番禺区','花都区','萝岗区','南沙区','增城','从化']
},
{
	n:'深圳',
	d:['福田区','罗湖区','南山区','盐田区','宝安区','龙岗区','坪山新区','光明新区','龙华新区','大鹏新区']
},								 	
{
	n:'天津',
	d:['和平区','河东区','河西区','南开区','河北区','红桥区','滨海新区','东丽区','西青区','津南区','北辰区','武清区','宝坻区','静海县','宁河县','蓟县']
},		 					
{
	n:'武汉',
	d:['江岸区','江汉区','硚口区','汉阳区','武昌区','青山区','洪山区','蔡甸区','东西湖区','汉南区','江夏区','黄陂区','新洲区','武汉经济技术开发区','东湖新技术开发区','武汉吴家山经济技术开发区']
},															
{
	n:'西安',
	d:['新城区','碑林区','莲湖区','雁塔区','未央区','灞桥区','长安区','阎良区','临潼区','蓝田县','周至县','户县','高陵县','沣渭新区','高新技术产业开发区','经济技术开发区','曲江新区','浐灞生态区','阎良国家航空高新技术产业基地','西安国家民用航天产业基地','国际港务区']
},					 					 																
{
	n:'成都',
	d:['青羊区','锦江区','金牛区','武侯区','成华区','龙泉驿区','青白江区','新都区','温江区','双流县','郫县','金堂县','大邑县','蒲江县','新津县','邛崃市','崇州市','彭州市','都江堰市','高新区']
},															
{
	n:'大连',
	d:['西岗区','中山区','沙河口区','甘井子区','高新园区','开发区','旅顺口区','金州区','普兰店市','瓦房店市','庄河市','长海县','长兴岛']
},																											
{
	n:'沈阳',
	d:['和平区','沈河区','皇姑区','大东区','铁西区','东陵区（浑南新区）','于洪区','沈北新区','苏家屯区','棋盘山开发区','新民市','辽中县','康平县','法库县']
},									 																													
{
	n:'南京',
	d:['玄武区','秦淮区','建邺区','鼓楼区','浦口区','六合区','栖霞区','雨花台区','江宁区','溧水县','高淳县']
},															
{
	n:'济南',
	d:['市中区','历下区','天桥区','槐荫区','历城区','长清区','平阴县','济阳县','商河县','高新区','章丘市']
},
		 																																	
{
	n:'青岛',
	d:['市南区','市北区（新行政区）','李沧区','黄岛区（新行政区）','崂山区','城阳区','胶州市','即墨市','平度市','莱西市','保税区','青岛经济技术开发区','青岛高新技术产业开发区']
},															
{
	n:'杭州',
	d:['上城区','下城区','江干区','拱墅区','西湖区','滨江区','萧山区','余杭区','桐庐县','淳安县','建德市','下沙','临安市','富阳市']
},															
{
	n:'苏州',
	d:['虎丘区','吴中区','相城区','工业园区','高新区','姑苏区','吴江区']
},															
{
	n:'无锡',
	d:['江阴市','宜兴市','崇安区','南长区','北塘区','滨湖区','无锡新区','惠山区','锡山区']
},															
{
	n:'重庆',
	d:['渝中区','江北区','南岸区','沙坪坝区','九龙坡区','大渡口区','渝北区','巴南区','北碚区','万州区','黔江区','永川区','涪陵区','长寿区','江津区','合川区','双桥区','万盛区','南川区',' 荣昌县','大足县','壁山县','铜梁县','潼南县','綦江县','忠县','开县','云阳县','梁平县','垫江县',' 丰都县','奉节县','巫山县','巫溪县','城口县','武隆县','石柱县','秀山县','酉阳县','彭水县','北部新区','石柱土家族自治县','秀山土家族苗族自治县','酉阳土家族苗族自治县','彭水苗族土家族自治县']
},															
{
	n:'郑州',
	d:['中原区','二七区','管城区','金水区','惠济区','郑东新区','经开区','高新区','上街区','新郑市 ','登封市','新密市','荥阳市','中牟县','巩义市','航空港区']
},															
{
	n:'长沙',
	d:['芙蓉区','天心区','岳麓区','开福区','雨花区','望城区','长沙县','宁乡县','浏阳市']
},															
{
	n:'福州',
	d:['鼓楼区','台江区','仓山区','马尾区','晋安区','闽侯县','罗源县','连江县','永泰县','闽清县 ','平潭县','长乐','福清']
},															
{
	n:'厦门',
	d:['思明区','湖里区','集美区','海沧区','同安区','翔安区']
},															
{
	n:'哈尔滨',
	d:['南岗区','道里区','道外区','香坊区','松北区','平房区','呼兰区','阿城区','五常市','方正县','依兰县 ','宾县','巴彦县','木兰县','通河县','延寿县']
},															
{
	n:'石家庄',
	d:['长安区','桥东区','桥西区','新华区','裕华区','东开发区','井陉矿区','辛集市','藁城市','晋州市','新乐市','鹿泉市','正定县','平山县','元氏县','栾城县','行唐县','灵寿县','深泽县','无极县','赵县','高邑县','赞皇县','井陉县']
},															
{
	n:'合肥',
	d:['庐阳区','瑶海区','蜀山区','包河区','经济技术开发区','滨湖新区','新站综合开发试验区','高新区','政务文化新区','北城新区']
},															
{
	n:'惠州',
	d:['惠城区','惠阳区']
},															
{
	n:'太原',
	d:['小店区','迎泽区','杏花岭区','尖草坪区','万柏林区','晋源区','清徐县','阳曲县','娄烦县','古交市']
},															
{
	n:'烟台',
	d:['芝罘区','福山区','牟平区','莱山区','长岛县','龙口市','莱阳市','莱州市','蓬莱市','招远市 ','栖霞市','海阳市','高新区','开发区']
},															
{
	n:'佛山',
	d:['禅城区','三水区','高明区','南海区','顺德区']
},															
{
	n:'南昌',
	d:['东湖区','西湖区','青云谱区','青山湖区','湾里区','南昌县','新建县','进贤县','安义县']
},															
{
	n:'贵阳',
	d:['云岩区','南明区','花溪区','观山湖区（金阳新区）','白云区','乌当区','清镇市','修文县','息烽县','开阳县']
}];
var allCity = [

{
	n:'广东省',
	d:['广州','潮州','东莞','佛山','惠州','清远','汕头','深圳','顺德','湛江','肇庆','中山','珠海','江门','阳江','韶关','茂名','梅州','汕尾','河源','揭阳','云浮','开平','台山','普宁','南沙','龙川','鹤山']
},

{
	n:'江苏省',
	d:['南京','常熟','常州','昆山','连云港','南通','苏州','太仓','无锡','徐州','扬州','镇江','淮安','盐城','泰州','宿迁','张家港','江阴','丹阳','溧阳','泰兴','宜兴','靖江','句容','如皋','扬中','高邮','启东','盱眙','通州','金湖']
},

{
	n:'浙江省',
	d:['杭州','宁波','温州','绍兴','金华','台州','湖州','嘉兴','衢州','丽水','舟山','义乌','海宁','玉环县','平湖','永康','东阳','嘉善','余姚','慈溪','乐清','永嘉','桐乡','瑞安','温岭','上虞','诸暨','宁海','三门','德清','象山','方家山','龙泉']
},

{
	n:'安徽省',
	d:['合肥','安庆','蚌埠','芜湖','淮南','马鞍山','淮北','铜陵','黄山','滁州','阜阳','宿州','六安','亳州','池州','宣城','巢湖','凤阳','广德','宿松']
},

{
	n:'福建省',
	d:['福州','泉州','厦门','漳州','莆田','三明','南平','龙岩','宁德','泉港区','福安','晋江']
},

{
	n:'甘肃省',
	d:['兰州','嘉峪关','酒泉','金昌','白银','天水','张掖','武威','定西','陇南','平凉','庆阳','临夏','甘南']
},

{
	n:'广西',
	d:['南宁','北海','桂林','柳州','玉林','梧州','崇左','来宾','防城港','百色','钦州','贺州','河池','贵港']
},

{
	n:'贵州省',
	d:['贵阳','遵义','六盘水','安顺','毕节','铜仁','黔西南','黔东南','黔南']
},

{
	n:'海南省',
	d:['海口','三亚','三沙','洋浦区','文昌','琼海','万宁','儋州','东方','五指山','定安','屯昌','澄迈','临高','琼中','保亭','白沙','昌江','乐东','陵水']
},

{
	n:'河北省',
	d:['石家庄','保定','承德','邯郸','廊坊','秦皇岛','唐山','张家口','邢台','沧州','衡水','燕郊','固安','遵化','香河','三河']
},

{
	n:'河南省',
	d:['郑州','开封','洛阳','商丘','安阳','平顶山','新乡','焦作','濮阳','许昌','漯河','三门峡','鹤壁','周口','驻马店','南阳','信阳','济源','西平','长葛']
},


{
	n:'黑龙江省',
	d:['哈尔滨','大庆','佳木斯','牡丹江','齐齐哈尔','鸡西','鹤岗','双鸭山','伊春','七台河','黑河','绥化','大兴安岭','安达','双城','尚志','绥芬河','肇东']
},

{
	n:'湖北省',
	d:['武汉','十堰','襄阳','宜昌','潜江','荆门','荆州','黄石','鄂州','黄冈','孝感','咸宁','随州','仙桃','天门','神农架','恩施','公安','武穴','宜城']
},

{
	n:'湖南省',
	d:['长沙','湘潭','株洲','常德','衡阳','益阳','郴州','岳阳','邵阳','张家界','娄底','永州','怀化','湘西']
},

{
	n:'吉林省',
	d:['长春','吉林市','四平','辽源','通化','白山','松原','白城','延吉','延边','公主岭']
},

{
	n:'江西省',
	d:['南昌','九江','赣州','宜春','吉安','上饶','抚州','景德镇','萍乡','新余','鹰潭']
},


{
	n:'辽宁省',
	d:['沈阳','鞍山','大连','葫芦岛','抚顺','本溪','丹东','锦州','营口','阜新','辽阳','盘锦','铁岭','朝阳','兴城','海城','昌图','开原']
},


{
	n:'内蒙古',
	d:['呼和浩特','包头','赤峰','鄂尔多斯','乌海','通辽','呼伦贝尔','巴彦淖尔','乌兰察布','兴安盟','乌审旗','满洲里']
},


{
	n:'宁夏',
	d:['银川','石嘴山','吴忠','固原','中卫']
},

{
	n:'青海省',
	d:['西宁','海东','海西','海北','黄南','海南','果洛','玉树']
},

{
	n:'山东省',
	d:['济南','德州','东营','济宁','临沂','青岛','日照','泰安','威海','潍坊','烟台','淄博','枣庄','滨州','聊城','菏泽','莱芜','荣成','黄岛','乳山','城阳','即墨','肥城','兖州','海阳','胶州','胶南','平度','莱西']
},

{
	n:'山西省',
	d:['太原','大同','临汾','运城','长治','阳泉','晋城','朔州','晋中','忻州','吕梁','永济','和顺']
},

{
	n:'陕西省',
	d:['西安','宝鸡','咸阳','铜川','渭南','汉中','安康','商洛','延安','榆林','杨凌','兴平']
},

{
	n:'四川省',
	d:['成都','乐山','泸州','绵阳','内江','宜宾','自贡','攀枝花','德阳','广元','遂宁','南充','眉山','广安','达州','雅安','巴中','资阳','西昌','甘孜','阿坝','凉山','峨眉','简阳']
},

{
	n:'西藏',
	d:['拉萨','日喀则','林芝','山南','昌都','那曲','阿里']
},

{
	n:'新疆',
	d:['乌鲁木齐','喀什','克拉玛依','伊犁','阿克苏','哈密','石河子','阿拉尔','五家渠','图木舒克','昌吉','阿勒泰','吐鲁番','塔城','和田','巴音郭楞','博尔塔拉','奎屯市','乌苏','克州']
},

{
	n:'云南省',
	d:['昆明','大理','丽江','玉溪','曲靖','保山','昭通','普洱','临沧','红河','文山','西双版纳','德宏','楚雄','怒江','迪庆','思茅']
}
];								



var num  = 0;
var html = '<div class="laryer" id="cityDetails">'
			+'<div class="data-result" id="city-data-result">'
				+'<em>最多选择3项</em>'
			+'</div>'
			+'<div class="data-tabs" id="data-tabs">'
				+'<ul>'
					+'<li data-selector="tab-all" class="active"><a href="javascript:;"><span>全部</span><em></em></a></li>'
				+'</ul>'
			+'</div>'
			+'<div class="data-container">'
				+'<p class="data-title">热门城市</p>'
				+'<div class="data-list data-list-hot">'
					+'<ul class="clearfix">';
			
						for(var i=0; i<hotCity.length; i++){
							num ++;
							html +='<li><a href="javascript:;" data-type="hot" data-code="'+num+'"  data-index="'+i+'" class="d-item"><span>'+hotCity[i].n+'</span><label>0</label></a></li>';
						}
	   		 	html +='</ul>'
    			+'</div>';
    			html +='<p class="data-title mt20">全部城市</p>'
				+'<div class="data-list data-list-hot">'
					+'<ul class="clearfix">';
						
						for(var i=0; i<allCity.length; i++){
							num++;
							html +='<li><a href="javascript:;" data-type="all" data-code="'+num+'" data-index="'+i+'" class="d-item"><span>'+allCity[i].n+'</span><label>0</label></a></li>';
						}
	   		 	html +='</ul>'
    			+'</div>'
			+'</div>'
			+'<div class="data-container data-container-sub" id="data-container-sub"></div>'
			+'<div class="data-error">最多只能选择 3 项</div>'
			
			+'<div class="btnBox">'
			+'<a id="affirmBtn" class="baseBtn btn-lar mr10" href="javascript:;" onclick="saveCity()">确 认</a>'
			+'<a id="cancelBtn" class="baseBtn baseBtnGray btn-lar" href="javascript:;" onclick="closeBoxy()">取消</a>'
			+'</div>'
			
		+'</div>';
		

$('body').append(html);



$(function(){

	$('#cityInp').focus(function(){
		new Boxy('#cityDetails',{'title':'选择城市信息','draggable':true});
		$(this).blur();
	});
	

		
	var oDataTab	= $('#data-tabs'),
	oDataTabUl	= oDataTab.children('ul'),
	oDataSub	= $('#data-container-sub'),
	oSubCity	= $('#subListCity'),
	oDataResult = $('#city-data-result'),
	aDataSpan   = oDataResult.find('span'),
	aDataClose	= aDataSpan.find('i');
	

	$('.data-list-hot li').on('click',function(){
		
		if(!checkCityNums()){
			return false;
		}
		

		var _txt=$(this).find('a span').text();
		var str ='<li class="active"><a href="javascript:;"><span>'+_txt+'</span><em></em></a></li>';	
		var html='';
		oDataTabUl.append(str);
		oDataTabUl.find('li').eq(0).removeClass('active');
		
		
		var type = $(this).find('a').attr('data-type');
		var index = parseInt($(this).find('a').attr('data-index'));
		var code = parseInt($(this).find('a').attr('data-code'));
		
		html+='<div class="data-list data-list-hot">'
			+'<p class="data-all"><a href="javascript:;" data-code="'+code+'" class="d-item d-item-all"><span>'+_txt+'</span><label></label></a></p>'
			+'<ul class="clearfix" id="subListCity">';
	
				
		
		if(type=='hot'){
			for(var i=0; i<hotCity[index].d.length;i++){
				
				
				html +='<li><a href="javascript:;" data-type="hot" data-code="'+code+'_'+i+'" class="d-item">'+hotCity[index].d[i]+'</a></li>';
				
				
			}
			
		}else{
			
			
			for(var i=0; i<allCity[index].d.length;i++){
				
				html +='<li><a href="javascript:;" data-type="all" data-code="'+code+'_'+i+'" class="d-item">'+allCity[index].d[i]+'</a></li>';
				
			}
			
		}
		html +='</ul>'
		+'</div>';
		oDataSub.append(html).show();
		
		
		resultCity();
		
		
		
	})
	
	
	
	
	//返回全部
	$("li[data-selector=tab-all]").on('click',function(){
		oDataSub.hide().html('');
		oDataTabUl.find('li').eq(0).addClass('active');
		oDataTabUl.find('li').eq(1).remove();
		
		resultCity();
	})

	
	//选择全部城市列表 
	$(".d-item-all").live('click',function(){
		var code = $(this).attr('data-code');
		var txt  = $(this).find('span').text();
		
		//去掉下部份的城市 选 中效果
			$('[data-code^='+code+']').removeClass('d-item-multies d-item-active').find('label').html('0');
			
			$('#city-data-result span[data-code^='+code+']').remove();
			
		if(checkCityNums()){
			//添加上面标签
			$(this).removeClass('d-item-multies').find('label').html('0');
			oDataResult.append('<span data-code="'+code+'"><b>'+txt+'</b><i>×</i></span>');
			
		}
		
		resultCity();
		
	})
	
	
	
	//下部份城市 选择
	$('#subListCity li').live('click',function(){
		
		var n=0;
		if(checkCityNums()){
			var code = $(this).find('a').attr('data-code');
			var aCode= code.split('_');
			var txt  = $(this).find('a').text();
			
			n++;
			$('#city-data-result span[data-code='+aCode[0]+']').remove();
			//添加上面标签
			
			$('[data-code='+aCode[0]+']').removeClass('d-item-active');
			
			oDataResult.append('<span data-code="'+code+'"><b>'+txt+'</b><i>×</i></span>');
			resultCity();
			
		}
		
		
		
		
		
	})
	
	
	//删除
	aDataSpan.find('i').live('click',function(){

		
		

		var code = $(this).parent().attr('data-code');
		var aCode= code.split('_');
		$('#city-data-result span[data-code='+code+']').remove();
		
		$('[data-code='+code+']').removeClass('d-item-active');
		//$('[data-code='+aCode[0]+']').removeClass('d-item-multies d-item-active').find('label').html('0');
		
		var allCity    =  $('[data-code='+aCode[0]+']');
		var allCityNum =  parseInt(allCity.find('label').html());
		
		allCityNum--;
		if(allCityNum>0){
			allCity.addClass('d-item-multies').find('label').html(allCityNum);
		}else{
			allCity.removeClass('d-item-multies d-item-active').find('label').html('0');
		}
		
		
		
		checkCityNums();
		resultCity();
			
		
	})
	
		
		

	
})

//确定结果选择项
function resultCity(){
	
	var oDataResult = $('#city-data-result');
	var arrVal=[];
	
	
	
	//$('.data-list-hot li a').removeClass('d-item-multies d-item-active').find('label').html('0');
	
	oDataResult.find('span').each(function(){
		var code = $(this).attr('data-code');
		arrVal.push(code);
	})
	
	
	
	for(var i=0; i<arrVal.length; i++){
		//循环这三个值，取得code
		//有这个code的话就让选中状态
		$('[data-code='+arrVal[i]+']').addClass('d-item-active');		
	}
	
	var iN=0;
	var curCode='';
	
	$('#subListCity li').each(function(){
		var oA=$(this).find('a');
		
		if(oA.hasClass('d-item-active')){
			iN++;
			curCode = oA.attr('data-code').split('_')[0];
		}
		
	})
	
	
	
	$('[data-code='+curCode+']').addClass('d-item-multies').find('label').html(iN);
	
	
}


function checkCityNums(){
	var iSize=$('#city-data-result span').size();
	
	if(iSize<3){
		$('.data-error').hide();
		return true;
	}else{
		$('.data-error').show();
		return false;
	}
	
}

function saveCity(){
	var val='';
	$('#city-data-result span').each(function(){
		val+=$(this).find('b').html()+' ';
		
	});
	
	$('#cityInp').val(val);
	
	closeBoxy();
	
}
